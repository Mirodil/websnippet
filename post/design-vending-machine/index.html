<!DOCTYPE html><html lang="en-us"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/images/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><style type="text/css">
/*!
 *  Font Awesome v4.7.0 by @davegandy - http://fontawesome.io - @fontawesome
 *  License - http://fontawesome.io/license (Font: SIL OFL 1.1, CSS: MIT License)
 */
@import url('//use.fontawesome.com/releases/v4.7.0/css/font-awesome-css.min.css');
@font-face {
  font-family: 'FontAwesome';
  src: url('//use.fontawesome.com/releases/v4.7.0/fonts/fontawesome-webfont.eot');
  src: url('//use.fontawesome.com/releases/v4.7.0/fonts/fontawesome-webfont.eot?#iefix') format('embedded-opentype'),
       url('//use.fontawesome.com/releases/v4.7.0/fonts/fontawesome-webfont.woff2') format('woff2'),
       url('//use.fontawesome.com/releases/v4.7.0/fonts/fontawesome-webfont.woff') format('woff'),
       url('//use.fontawesome.com/releases/v4.7.0/fonts/fontawesome-webfont.ttf') format('truetype'),
       url('//use.fontawesome.com/releases/v4.7.0/fonts/fontawesome-webfont.svg#fontawesomeregular') format('svg');
  font-weight: normal;
  font-style: normal;
}
</style><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds2.feedburner.com/WebSnippet"/><link rel="preload" href="/_next/static/css/62471b3e8c416327.css" as="style"/><link rel="stylesheet" href="/_next/static/css/62471b3e8c416327.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-69bfa6990bb9e155.js" defer=""></script><script src="/_next/static/chunks/framework-a87821de553db91d.js" defer=""></script><script src="/_next/static/chunks/main-97b74781aeb112e6.js" defer=""></script><script src="/_next/static/chunks/pages/_app-9ee69c8c8cf813d9.js" defer=""></script><script src="/_next/static/chunks/378-832f988b0b0f29dc.js" defer=""></script><script src="/_next/static/chunks/144-82be5382b00aacbb.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-2a6f05f16fafcbee.js" defer=""></script><script src="/_next/static/z84iE6Zk4FFHfZosq-xyV/_buildManifest.js" defer=""></script><script src="/_next/static/z84iE6Zk4FFHfZosq-xyV/_ssgManifest.js" defer=""></script><script src="/_next/static/z84iE6Zk4FFHfZosq-xyV/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="container-fluid"><div class="row"><div class="col-md-3"><header><div class="logo"><a href="/">Web <!-- --><span class="text-danger">{</span><span class="snippet">Snippet</span><span class="text-danger">}</span></a></div><hr/><div class="social"><a href="https://www.facebook.com/websnippet.io" title="facebook" rel="nofollow"><i class="fa fa-facebook" aria-hidden="true"></i><span class="sr-only">facebook</span></a><a href="https://twitter.com/WebSnippetio" title="twitter" rel="nofollow"><i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">twitter</span></a><a href="https://plus.google.com/109007174257357268166" title="google+" rel="nofollow"><i class="fa fa-google-plus" aria-hidden="true"></i><span class="sr-only">google+</span></a><a href="http://feeds2.feedburner.com/WebSnippet" title="rss"><i class="fa fa-rss" aria-hidden="true"></i><span class="sr-only">rss</span></a></div><hr/><ul class="nav nav-stacked"><li role="presentation"><a href="/" title="">Home</a></li><li role="presentation"><a href="/tools-and-resources" title="Tools and Resources">Tools &amp; Resources</a></li><li role="presentation"><a href="/about" title="About">About</a></li><li role="presentation"><a href="/contact" title="Support">Support</a></li><li role="presentation"><a href="/contact" title="Contacts">Contacts</a></li></ul></header></div><div class="col-md-6"><article class="post"><div class="page-header"><h1><a href="/post/design-vending-machine" title="How do you design the Vending Machine">How do you design the Vending Machine</a></h1></div><div class="meta text-muted"><time dateTime="2021-10-01T00:00:00.854Z"><i class="fa fa-clock-o"></i> <!-- -->October 1, 2021<!-- --></time><span><i class="fa fa-bookmark"></i> <!-- --><a href="/categories/System Design" title="System Design" rel="category"><strong>System Design</strong></a></span><span class="pull-right"><i class="fa fa-comments"></i> <!-- --><a href="/post/design-vending-machine" title="How do you design the Vending Machine">0 comment</a></span></div><div class="content"><div class="entry-colors"><div class="red"></div><div class="blue"></div><div class="gray"></div></div><div class="text-center"><img src="/assets/design-vending-machine.jpg" alt="How do you design the Vending Machine" class="image-head img-responsive"/></div><div class="raw"><h1>How do you design the Vending Machine<!-- --></h1>
<!-- --><p>You need to write code to implement a Vending machine that has a bunch of products like chocolates, candy, cold-drink, and accept some coins like Nickle, Dime, Quarter, Cent, etc. Make sure you insert a coin, get a product back, and get your chance back.<!-- --></p>
<!-- --><p>We are going to make some assumtions to simplicity sake:<!-- --></p>
<!-- --><ul>
<!-- --><li>We assume we have endless products, so we don&#x27;t have throw a ProductSoldOutExcepiton<!-- --></li>
<!-- --><li>We assume we have endless coins, so we don&#x27;t have throw a NotSufficientChangeException<!-- --></li>
<!-- --></ul>
<!-- --><h3>State transition diagrams<!-- --></h3>
<!-- --><p>State transition diagram is an efficient form for depicting a finite state machine, and it is called a state transition diagram. We will start with a state transition diagram, and we follow the arrows, and we say the arrows in the <!-- --><code>Given-When-Then<!-- --></code> form, then you get something like this.
Let&#x27;s draw state transition diagramm for the Vending Machine.<!-- --></p>
<!-- --><p><img src="/assets/design-vending-machine-state-transition-diagram.svg" alt="vending machine state transition diagram"/></p>
<!-- --><h3>State transition tables<!-- --></h3>
<!-- --><p>State transition table is in <!-- --><code>given-&gt;then-&gt;then<!-- --></code> form:<!-- --></p>
<!-- --><p>| Given State   | Event       | Next State      | Action    |
| -----------   | ----------- | --------------  | ----------|
| ProductsState | select      | ChargeState     | display charge |
| ChargeState   | coin        | CollectState    | return product &amp; refund |
| CollectState  | reset       | ProductsState   | display products |
| ProductsState | coin        | ProductsState   | return changes |
| CollectState  | coin        | CollectState    | display charge // when not enought coin |
| CollectState  | select      | CollectState    | display charge |
| ChargeState   | select      | ChargeState     | display charge // change product |<!-- --></p>
<!-- --><h3>Implementation<!-- --></h3>
<!-- --><p>The simplest way is to implement with switch-case statements. We need to create our events and state as enum and implement VendingMachine finite state machine.<!-- --></p>
<!-- --><pre><code class="language-typescript">enum EVENTS {
    SELECT,
    COIN,
    RESET
}

enum STATE {
    PRODUCTS,
    CHARGE,
    COLLECT
}

type Product = {
    name: string;
    price: number;
};

interface IVendingMachine {
    refund(charges: number): void;
    unloadProduct(selectedProduct: Product): void;
    displayCharges(price: number): void;
    displayProducts(list: Product[]): void;
}

/**
 * VendingMachine - finite state machine
 */
class VendingMachineFSM {
    private products: Array&lt;Product&gt; = [];
    private selectedProduct?: Product;
    private balance: number = 0;
    private state: STATE;
    private vm: IVendingMachine;

    constructor(vm: IVendingMachine) {
        this.vm = vm;
        this.state = STATE.PRODUCTS;
    }

    handleEvents(event: EVENTS, product: Product, coin: number) {
        switch (this.state) {
            case STATE.PRODUCTS:
                switch (event) {
                    case EVENTS.SELECT:
                        this.state = STATE.CHARGE;
                        this.selectedProduct = product;
                        this.balance = this.selectedProduct.price;
                        this.vm.displayCharges(this.balance);
                        break;
                    case EVENTS.COIN:
                    case EVENTS.RESET:
                        this.selectedProduct = undefined;
                        this.balance = 0;
                        this.vm.displayProducts(this.products);
                        break;
                }
                break;
            case STATE.CHARGE:
                switch (event) {
                    case EVENTS.SELECT:
                        this.selectedProduct = product;
                        this.balance = this.selectedProduct.price;
                        this.vm.displayCharges(this.balance);
                    case EVENTS.COIN:
                        this.state = STATE.COLLECT;
                        this.balance -= coin;
                        if (this.balance &lt;= 0) {
                            this.vm.unloadProduct(this.selectedProduct!);
                            this.vm.refund(this.balance);
                            this.state = STATE.PRODUCTS;
                        } else {
                            this.vm.displayCharges(this.balance);
                        }
                    case EVENTS.RESET:
                        this.state = STATE.PRODUCTS;
                        this.selectedProduct = undefined;
                        this.balance = 0;
                }
                break;
            case STATE.COLLECT:
                switch (event) {
                    case EVENTS.COIN:
                        this.balance -= coin;
                        if (this.balance &lt;= 0) {
                            this.vm.unloadProduct(this.selectedProduct!);
                            this.vm.refund(this.balance);
                            this.state = STATE.PRODUCTS;
                        } else {
                            this.vm.displayCharges(this.balance);
                        }
                    case EVENTS.SELECT:
                    case EVENTS.RESET:
                        this.state = STATE.PRODUCTS;
                        this.selectedProduct = undefined;
                        this.balance = 0;
                        this.vm.displayProducts(this.products);
                        break;
                }
        }
    }
}
<!-- --></code></pre>
<!-- --><p>As you can notice we are sperating a state(<!-- --><code>VendingMachineFSM<!-- --></code>) from a vending machine(<!-- --><code>IVendingMachine<!-- --></code>) by using interface.
As Vending Machine is a State Machine. The events and actions are what is being controlled, and the finite state machine is how that control is managed, and those two can be encapsulated and kept completely separate from one another. The separation of what from how is one of the most essential aspects of good software design.
Too often we find software systems in which what from how are so intertangled that it&#x27;s very difficult to separate operation from policy. And when you can&#x27;t separate what from how, well then you wind up with systems that are pretty fragile.<!-- --></p>
<!-- --><p>The other version is implement state transition table using lists or dictionary data structure and it called table driven approach.<!-- --></p>
<!-- --><h3>State pattern<!-- --></h3>
<!-- --><blockquote>
<!-- --><p>The state pattern is a behavioral software design pattern that allows an object to alter its behavior when its internal state changes
wiki<!-- --></p>
<!-- --></blockquote>
<!-- --><pre><code class="language-typescript">
interface IVendingMachineState {
    reset(vm: VendingMachineFSM_DP): void;
    coin(vm: VendingMachineFSM_DP, coin: number): void;
    select(vm: VendingMachineFSM_DP, product: Product): void;
}

abstract class VendingMachineFSM_DP {
    state: IVendingMachineState;
    balance: number = 0;
    selectedProduct?: Product;
    availableProducts: Product[] = [];

    constructor(state: IVendingMachineState) {
        this.state = state;
    }

    select(product: Product) {
        this.state.select(this, product);
    }

    coin(coin: number) {
        this.state.coin(this, coin);
    }

    reset() {
        this.state.reset(this);
    }

    // methods will be implemented by concrete Vending Machine
    abstract returnChanges(charges: number): void;
    abstract unloadProduct(selectedProduct: Product): void;
    abstract displayCharges(price: number): void;
    abstract displayProducts(list: Product[]): void;
}

class ProductState implements IVendingMachineState {
    reset(vm: VendingMachineFSM_DP): void {
        vm.displayProducts(vm.availableProducts);
    }

    coin(vm: VendingMachineFSM_DP, coin: number): void {
        vm.returnChanges(coin);
        vm.displayProducts(vm.availableProducts);
    }

    select(vm: VendingMachineFSM_DP, product: Product): void {
        vm.state = new ChargeState();
        vm.balance = product.price
        vm.displayCharges(vm.balance);
    }
}

class ChargeState implements IVendingMachineState {
    reset(vm: VendingMachineFSM_DP): void {
        vm.state = new ProductState();
        vm.displayProducts(vm.availableProducts);
    }

    coin(vm: VendingMachineFSM_DP, coin: number): void {
        vm.state = new ChargeState();
        vm.balance -= coin;
        if (vm.balance &lt;= 0) {
            vm.state = new ProductState();
            vm.unloadProduct(vm.selectedProduct!);
            vm.returnChanges(vm.balance);
        } else {
            vm.displayCharges(vm.balance);
        }
    }

    select(vm: VendingMachineFSM_DP, product: Product): void {
        vm.balance = product.price;
        vm.displayCharges(product.price);
    }
}

class CollectState implements IVendingMachineState {
    reset(vm: VendingMachineFSM_DP): void {
        throw new Error(&quot;Method not implemented.&quot;);
    }

    coin(vm: VendingMachineFSM_DP, coin: number): void {
        vm.balance -= coin;
        if (vm.balance &lt;= 0) {
            vm.state = new ProductState();
            vm.unloadProduct(vm.selectedProduct!);
            vm.returnChanges(vm.balance);
        } else {
            vm.displayCharges(vm.balance);
        }
    }

    select(vm: VendingMachineFSM_DP, product: Product): void {
        throw new Error(&quot;Method not implemented.&quot;);
    }

}

<!-- --></code></pre></div><ul class="share"><li class="presentation">Share this:</li><li class="presentation"><a href="https://www.facebook.com/sharer/sharer.php?u=/post/design-vending-machine" target="_blank" rel="nofollow" title="How do you design the Vending Machine"><i class="fa fa-facebook"></i> <!-- --><span class="hidden-xs">Facebook</span></a></li><li class="presentation"><a href="https://twitter.com/home?status=How do you design the Vending Machine+/post/design-vending-machine" target="_blank" rel="nofollow" title="How do you design the Vending Machine"><i class="fa fa-twitter"></i> <!-- --><span class="hidden-xs">Twitter</span></a></li><li class="presentation"><a href="https://plus.google.com/share?url=/post/design-vending-machine" target="_blank" rel="nofollow" title="How do you design the Vending Machine"><i class="fa fa-google-plus"></i> <!-- --><span class="hidden-xs">Google+</span></a></li><li class="presentation"><a href="http://www.stumbleupon.com/submit?url=/post/design-vending-machine&amp;amp;title=How do you design the Vending Machine" target="_blank" rel="nofollow" title="How do you design the Vending Machine"><i class="fa fa-stumbleupon"></i> <!-- --><span class="hidden-xs">Stumble</span></a></li><li class="presentation"><a href="http://digg.com/submit?url=/post/design-vending-machine&amp;amp;title=How do you design the Vending Machine" target="_blank" rel="nofollow" title="How do you design the Vending Machine"><i class="fa fa-digg"></i> <!-- --><span class="hidden-xs">Digg</span></a></li></ul></div></article></div><div class="col-md-3"><div class="widget panel panel-default"><div class="panel-heading"><h4>Follow Us<!-- --><span class="social pull-right"><a href="https://www.facebook.com/websnippet.io" title="facebook" rel="nofollow" target="_blank" class="nodecoration"><i class="fa fa-facebook" aria-hidden="true"></i><span class="sr-only">facebook</span></a><a href="https://twitter.com/WebSnippetio" title="twitter" rel="nofollow" target="_blank" class="nodecoration"><i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">twitter</span></a><a href="https://plus.google.com/109007174257357268166" title="google+" rel="nofollow" target="_blank" class="nodecoration"><i class="fa fa-google-plus" aria-hidden="true"></i><span class="sr-only">google+</span></a><a href="http://feeds2.feedburner.com/WebSnippet" title="rss" target="_blank" class="nodecoration"><i class="fa fa-rss" aria-hidden="true"></i><span class="sr-only">rss</span></a></span></h4></div><div class="panel-body"><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow"><input type="hidden" name="uri" value="WebSnippet"/><input type="hidden" name="loc" value="en_US"/><div class="form-group"><label class="sr-only" for="subemail">Enter your email address</label><div class="input-group"><input type="text" id="subemail" name="email" class="form-control" placeholder="Your email address..."/><span class="input-group-btn"><button class="btn btn-default" type="submit" aria-label="Subscribe"><i class="fa fa-fire" aria-hidden="true"></i></button></span></div></div></form></div></div><div class="widget panel panel-default"><div class="panel-heading"><h4>CATEGORIES</h4></div><div class="panel-body"><nav><h5><a href="/categories/algorithm" title="Algorithm">Algorithm<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5><h5><a href="/categories/design" title="Design">Design<!-- --> (<!-- -->10<!-- -->)<!-- --></a></h5><h5><a href="/categories/development" title="Development">Development<!-- --> (<!-- -->38<!-- -->)<!-- --></a></h5><h5><a href="/categories/interview" title="Interview">Interview<!-- --> (<!-- -->4<!-- -->)<!-- --></a></h5><h5><a href="/categories/mobile-development" title="Mobile-Development">Mobile-Development<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5><h5><a href="/categories/resources" title="Resources">Resources<!-- --> (<!-- -->15<!-- -->)<!-- --></a></h5><h5><a href="/categories/system design" title="System Design">System Design<!-- --> (<!-- -->3<!-- -->)<!-- --></a></h5><h5><a href="/categories/system-design" title="System-Design">System-Design<!-- --> (<!-- -->2<!-- -->)<!-- --></a></h5><h5><a href="/categories/tools" title="Tools">Tools<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5><h5><a href="/categories/web management" title="Web Management">Web Management<!-- --> (<!-- -->5<!-- -->)<!-- --></a></h5><h5><a href="/categories/web-development" title="Web-Development">Web-Development<!-- --> (<!-- -->37<!-- -->)<!-- --></a></h5></nav></div></div><div class="widget panel panel-default"><div class="panel-heading"><h4>TAGS</h4></div><div class="panel-body"><nav><h5><a href="/tags/.net" title=".NET">.NET<!-- --> (<!-- -->2<!-- -->)<!-- --></a></h5><h5><a href="/tags/algorithm" title="Algorithm">Algorithm<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5><h5><a href="/tags/angularjs" title="AngularJS">AngularJS<!-- --> (<!-- -->4<!-- -->)<!-- --></a></h5><h5><a href="/tags/css" title="CSS">CSS<!-- --> (<!-- -->7<!-- -->)<!-- --></a></h5><h5><a href="/tags/html" title="HTML">HTML<!-- --> (<!-- -->4<!-- -->)<!-- --></a></h5><h5><a href="/tags/interview" title="Interview">Interview<!-- --> (<!-- -->9<!-- -->)<!-- --></a></h5><h5><a href="/tags/javascript" title="JavaScript">JavaScript<!-- --> (<!-- -->27<!-- -->)<!-- --></a></h5><h5><a href="/tags/mobile" title="Mobile">Mobile<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5><h5><a href="/tags/node.js" title="Node.JS">Node.JS<!-- --> (<!-- -->8<!-- -->)<!-- --></a></h5><h5><a href="/tags/react" title="React">React<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5><h5><a href="/tags/tools" title="Tools">Tools<!-- --> (<!-- -->1<!-- -->)<!-- --></a></h5></nav></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"How do you design the Vending Machine","description":"How do you design the Vending Machine. We will write code to implement a Vending machine that has a bunch of products like chocolates, candy, cold-drink, and accept some coins like Nickle, Dime, Quarter, Cent, etc. Make sure you insert a coin, get a product back, and get your chance back.","date":"2021-10-01T00:00:00.854Z","lastmod":"2021-10-01T00:00:00.854Z","slug":"design-vending-machine","categories":["System Design"],"tags":["Interview"],"thumbnail":"/assets/design-vending-machine.jpg","image":"/assets/design-vending-machine.jpg","content":"\n\n# How do you design the Vending Machine\n\nYou need to write code to implement a Vending machine that has a bunch of products like chocolates, candy, cold-drink, and accept some coins like Nickle, Dime, Quarter, Cent, etc. Make sure you insert a coin, get a product back, and get your chance back.\n\nWe are going to make some assumtions to simplicity sake:\n- We assume we have endless products, so we don't have throw a ProductSoldOutExcepiton\n- We assume we have endless coins, so we don't have throw a NotSufficientChangeException\n\n\n### State transition diagrams\n\nState transition diagram is an efficient form for depicting a finite state machine, and it is called a state transition diagram. We will start with a state transition diagram, and we follow the arrows, and we say the arrows in the `Given-When-Then` form, then you get something like this.\nLet's draw state transition diagramm for the Vending Machine.\n\n![vending machine state transition diagram](/assets/design-vending-machine-state-transition-diagram.svg) \n\n### State transition tables\nState transition table is in `given-\u003ethen-\u003ethen` form:\n\n| Given State   | Event       | Next State      | Action    |\n| -----------   | ----------- | --------------  | ----------|\n| ProductsState | select      | ChargeState     | display charge |\n| ChargeState   | coin        | CollectState    | return product \u0026 refund |\n| CollectState  | reset       | ProductsState   | display products |\n| ProductsState | coin        | ProductsState   | return changes |\n| CollectState  | coin        | CollectState    | display charge // when not enought coin |\n| CollectState  | select      | CollectState    | display charge |\n| ChargeState   | select      | ChargeState     | display charge // change product |\n\n\n### Implementation\n\nThe simplest way is to implement with switch-case statements. We need to create our events and state as enum and implement VendingMachine finite state machine.\n\n\n```typescript\nenum EVENTS {\n    SELECT,\n    COIN,\n    RESET\n}\n\nenum STATE {\n    PRODUCTS,\n    CHARGE,\n    COLLECT\n}\n\ntype Product = {\n    name: string;\n    price: number;\n};\n\ninterface IVendingMachine {\n    refund(charges: number): void;\n    unloadProduct(selectedProduct: Product): void;\n    displayCharges(price: number): void;\n    displayProducts(list: Product[]): void;\n}\n\n/**\n * VendingMachine - finite state machine\n */\nclass VendingMachineFSM {\n    private products: Array\u003cProduct\u003e = [];\n    private selectedProduct?: Product;\n    private balance: number = 0;\n    private state: STATE;\n    private vm: IVendingMachine;\n\n    constructor(vm: IVendingMachine) {\n        this.vm = vm;\n        this.state = STATE.PRODUCTS;\n    }\n\n    handleEvents(event: EVENTS, product: Product, coin: number) {\n        switch (this.state) {\n            case STATE.PRODUCTS:\n                switch (event) {\n                    case EVENTS.SELECT:\n                        this.state = STATE.CHARGE;\n                        this.selectedProduct = product;\n                        this.balance = this.selectedProduct.price;\n                        this.vm.displayCharges(this.balance);\n                        break;\n                    case EVENTS.COIN:\n                    case EVENTS.RESET:\n                        this.selectedProduct = undefined;\n                        this.balance = 0;\n                        this.vm.displayProducts(this.products);\n                        break;\n                }\n                break;\n            case STATE.CHARGE:\n                switch (event) {\n                    case EVENTS.SELECT:\n                        this.selectedProduct = product;\n                        this.balance = this.selectedProduct.price;\n                        this.vm.displayCharges(this.balance);\n                    case EVENTS.COIN:\n                        this.state = STATE.COLLECT;\n                        this.balance -= coin;\n                        if (this.balance \u003c= 0) {\n                            this.vm.unloadProduct(this.selectedProduct!);\n                            this.vm.refund(this.balance);\n                            this.state = STATE.PRODUCTS;\n                        } else {\n                            this.vm.displayCharges(this.balance);\n                        }\n                    case EVENTS.RESET:\n                        this.state = STATE.PRODUCTS;\n                        this.selectedProduct = undefined;\n                        this.balance = 0;\n                }\n                break;\n            case STATE.COLLECT:\n                switch (event) {\n                    case EVENTS.COIN:\n                        this.balance -= coin;\n                        if (this.balance \u003c= 0) {\n                            this.vm.unloadProduct(this.selectedProduct!);\n                            this.vm.refund(this.balance);\n                            this.state = STATE.PRODUCTS;\n                        } else {\n                            this.vm.displayCharges(this.balance);\n                        }\n                    case EVENTS.SELECT:\n                    case EVENTS.RESET:\n                        this.state = STATE.PRODUCTS;\n                        this.selectedProduct = undefined;\n                        this.balance = 0;\n                        this.vm.displayProducts(this.products);\n                        break;\n                }\n        }\n    }\n}\n```\nAs you can notice we are sperating a state(`VendingMachineFSM`) from a vending machine(`IVendingMachine`) by using interface.\nAs Vending Machine is a State Machine. The events and actions are what is being controlled, and the finite state machine is how that control is managed, and those two can be encapsulated and kept completely separate from one another. The separation of what from how is one of the most essential aspects of good software design.\nToo often we find software systems in which what from how are so intertangled that it's very difficult to separate operation from policy. And when you can't separate what from how, well then you wind up with systems that are pretty fragile.\n\nThe other version is implement state transition table using lists or dictionary data structure and it called table driven approach.\n\n\n### State pattern\n\n\u003e The state pattern is a behavioral software design pattern that allows an object to alter its behavior when its internal state changes\n\u003e wiki\n\n```typescript\n\ninterface IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void;\n    coin(vm: VendingMachineFSM_DP, coin: number): void;\n    select(vm: VendingMachineFSM_DP, product: Product): void;\n}\n\nabstract class VendingMachineFSM_DP {\n    state: IVendingMachineState;\n    balance: number = 0;\n    selectedProduct?: Product;\n    availableProducts: Product[] = [];\n\n    constructor(state: IVendingMachineState) {\n        this.state = state;\n    }\n\n    select(product: Product) {\n        this.state.select(this, product);\n    }\n\n    coin(coin: number) {\n        this.state.coin(this, coin);\n    }\n\n    reset() {\n        this.state.reset(this);\n    }\n\n    // methods will be implemented by concrete Vending Machine\n    abstract returnChanges(charges: number): void;\n    abstract unloadProduct(selectedProduct: Product): void;\n    abstract displayCharges(price: number): void;\n    abstract displayProducts(list: Product[]): void;\n}\n\nclass ProductState implements IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void {\n        vm.displayProducts(vm.availableProducts);\n    }\n\n    coin(vm: VendingMachineFSM_DP, coin: number): void {\n        vm.returnChanges(coin);\n        vm.displayProducts(vm.availableProducts);\n    }\n\n    select(vm: VendingMachineFSM_DP, product: Product): void {\n        vm.state = new ChargeState();\n        vm.balance = product.price\n        vm.displayCharges(vm.balance);\n    }\n}\n\nclass ChargeState implements IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void {\n        vm.state = new ProductState();\n        vm.displayProducts(vm.availableProducts);\n    }\n\n    coin(vm: VendingMachineFSM_DP, coin: number): void {\n        vm.state = new ChargeState();\n        vm.balance -= coin;\n        if (vm.balance \u003c= 0) {\n            vm.state = new ProductState();\n            vm.unloadProduct(vm.selectedProduct!);\n            vm.returnChanges(vm.balance);\n        } else {\n            vm.displayCharges(vm.balance);\n        }\n    }\n\n    select(vm: VendingMachineFSM_DP, product: Product): void {\n        vm.balance = product.price;\n        vm.displayCharges(product.price);\n    }\n}\n\nclass CollectState implements IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    coin(vm: VendingMachineFSM_DP, coin: number): void {\n        vm.balance -= coin;\n        if (vm.balance \u003c= 0) {\n            vm.state = new ProductState();\n            vm.unloadProduct(vm.selectedProduct!);\n            vm.returnChanges(vm.balance);\n        } else {\n            vm.displayCharges(vm.balance);\n        }\n    }\n\n    select(vm: VendingMachineFSM_DP, product: Product): void {\n        throw new Error(\"Method not implemented.\");\n    }\n\n}\n\n```\n\n","permalink":"/post/design-vending-machine","site":{"categories":[{"name":"Algorithm","count":1},{"name":"Design","count":10},{"name":"Development","count":38},{"name":"Interview","count":4},{"name":"Mobile-Development","count":1},{"name":"Resources","count":15},{"name":"System Design","count":3},{"name":"System-Design","count":2},{"name":"Tools","count":1},{"name":"Web Management","count":5},{"name":"Web-Development","count":37}],"tags":[{"name":".NET","count":2},{"name":"Algorithm","count":1},{"name":"AngularJS","count":4},{"name":"CSS","count":7},{"name":"HTML","count":4},{"name":"Interview","count":9},{"name":"JavaScript","count":27},{"name":"Mobile","count":1},{"name":"Node.JS","count":8},{"name":"React","count":1},{"name":"Tools","count":1}]}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"design-vending-machine"},"buildId":"z84iE6Zk4FFHfZosq-xyV","isFallback":false,"gsp":true,"scriptLoader":[]}</script><footer><div class="container"><div class="text-center social"><a href="mailto:hello@websnippet.io" title="email" rel="nofollow"><i class="fa fa-envelope" aria-hidden="true"></i><span class="sr-only">email</span></a><a href="https://www.facebook.com/websnippet.io" title="facebook" rel="nofollow" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i><span class="sr-only">facebook</span></a><a href="https://twitter.com/WebSnippetio" title="twitter" rel="nofollow" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">twitter</span></a><a href="https://plus.google.com/109007174257357268166" title="google+" rel="nofollow" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i><span class="sr-only">google+</span></a><a href="http://feeds2.feedburner.com/WebSnippet" title="rss" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i><span class="sr-only">rss</span></a></div></div></footer></body></html>