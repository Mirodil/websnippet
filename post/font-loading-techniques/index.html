<!DOCTYPE html><html lang="en-us"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><link rel="shortcut icon" href="/favicon.ico"/><link rel="apple-touch-icon" sizes="57x57" href="/images/apple-icon-57x57.png"/><link rel="apple-touch-icon" sizes="60x60" href="/images/apple-icon-60x60.png"/><link rel="apple-touch-icon" sizes="72x72" href="/images/apple-icon-72x72.png"/><link rel="apple-touch-icon" sizes="76x76" href="/images/apple-icon-76x76.png"/><link rel="apple-touch-icon" sizes="114x114" href="/images/apple-icon-114x114.png"/><link rel="apple-touch-icon" sizes="120x120" href="/images/apple-icon-120x120.png"/><link rel="apple-touch-icon" sizes="144x144" href="/images/apple-icon-144x144.png"/><link rel="apple-touch-icon" sizes="152x152" href="/images/apple-icon-152x152.png"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-icon-180x180.png"/><link rel="icon" type="image/png" sizes="192x192" href="/images/android-icon-192x192.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="96x96" href="/images/favicon-96x96.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="stylesheet" href="https://use.fontawesome.com/c7d199424f.css"/><link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://feeds2.feedburner.com/WebSnippet"/><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/bbea82d028b1cf713e51.css" as="style"/><link rel="stylesheet" href="/_next/static/css/bbea82d028b1cf713e51.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-a54b4f32bdc1ef890ddd.js"></script><script src="/_next/static/chunks/webpack-61095c13c5984b221292.js" defer=""></script><script src="/_next/static/chunks/framework-2191d16384373197bc0a.js" defer=""></script><script src="/_next/static/chunks/main-49bcd45faeefa7f6716c.js" defer=""></script><script src="/_next/static/chunks/pages/_app-acb08fab9f1c222b1368.js" defer=""></script><script src="/_next/static/chunks/724-6d750a57714866617c3d.js" defer=""></script><script src="/_next/static/chunks/pages/post/%5Bslug%5D-a28104542e64fbbe7064.js" defer=""></script><script src="/_next/static/FoH3w9_hi_Ui1DqHiOWf8/_buildManifest.js" defer=""></script><script src="/_next/static/FoH3w9_hi_Ui1DqHiOWf8/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="container-fluid"><div class="row"><div class="col-md-3"><header><div class="logo"><a href="/">Web <span class="text-danger">{</span><span class="snippet">Snippet</span><span class="text-danger">}</span></a></div><hr/><div class="social"><a href="https://www.facebook.com/websnippet.io" title="facebook" rel="nofollow"><i class="fa fa-facebook" aria-hidden="true"></i><span class="sr-only">facebook</span></a><a href="https://twitter.com/WebSnippetio" title="twitter" rel="nofollow"><i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">twitter</span></a><a href="https://plus.google.com/109007174257357268166" title="google+" rel="nofollow"><i class="fa fa-google-plus" aria-hidden="true"></i><span class="sr-only">google+</span></a><a href="http://feeds2.feedburner.com/WebSnippet" title="rss"><i class="fa fa-rss" aria-hidden="true"></i><span class="sr-only">rss</span></a></div><hr/><ul class="nav nav-stacked"><li role="presentation"><a href="/" title="">Home</a></li><li role="presentation"><a href="/tools-and-resources" title="Tools and Resources">Tools &amp; Resources</a></li><li role="presentation"><a href="/about" title="About">About</a></li><li role="presentation"><a href="/contact" title="Support">Support</a></li><li role="presentation"><a href="/contact" title="Contacts">Contacts</a></li></ul></header></div><div class="col-md-6"><article class="post"><div class="page-header"><h1><a href="/post/font-loading-techniques" title="Font Loading Techniques">Font Loading Techniques</a></h1></div><div class="meta text-muted"><time dateTime="2015-06-13T09:12:43.044Z"><i class="fa fa-clock-o"></i> <!-- -->June 13, 2015</time><span><i class="fa fa-bookmark"></i> <a href="/categories/Web Management" title="Web Management" rel="category"><strong>Web Management</strong></a></span><span class="pull-right"><i class="fa fa-comments"></i> <a href="/post/font-loading-techniques" title="Font Loading Techniques">0 comment</a></span></div><div class="content"><div class="entry-colors"><div class="red"></div><div class="blue"></div><div class="gray"></div></div><div class="text-center"></div><div class="raw"><p>It seems as though most websites use non-default fonts these days and who can blame them?  System fonts are all pretty boring and custom fonts add a bit of flare and freshness to a site&#x27;s design.  Web fonts are great and make the web a more beautiful space; however, loading them can be slow, which results in an unwanted side effect. Let me show you a strategy for faster font loading!</p><h2>Put Fonts on CDN</h2><p>One simple solution for improving site speed is using a CDN, and that&#x27;s no different for fonts.  It&#x27;s important to ensure the CDN has proper CORS settings.</p><pre><code># Apache config
&lt;FilesMatch &quot;.(eot|ttf|otf|woff)&quot;&gt;
	Header set Access-Control-Allow-Origin &quot;*&quot;
&lt;/FilesMatch&gt;

# nginx config
if ($filename ~* ^.*?\.(eot)|(ttf)|(woff)$){
	add_header Access-Control-Allow-Origin *;
}</code></pre><p>You&#x27;ll see AJAX / cross-domain errors in the console if the CDN&#x27;s CORS settings are not properly configured.</p><h2>Use Non-Blocking CSS Loading</h2><p> It&#x27;s actually genius, which outlines a strategy for preventing CSS loading from blocking render. </p><pre><code>&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;fonts.css&quot; media=&quot;none&quot; onload=&quot;this.media=&#x27;all&#x27;;&quot;&gt;
&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;style.css&quot; media=&quot;none&quot; onload=&quot;this.media=&#x27;all&#x27;;&quot;&gt;</code></pre><p>Essentially using media=none let&#x27;s the browser download the stylesheet without blocking rendering, so when the stylesheet has loaded, setting the media(<code>onload=&quot;this.media=&#x27;all&#x27;;&quot;</code>) to its desired setting will then render the screen as it should.</p><h2>Storing Fonts in localStorage</h2><p>First let’s add a class to the <code>&lt;html&gt;</code> DOM node that will hold the fallback font styles. Using JavaScript, this will later be replaced with a class that has the styles of the loaded font. We will also save a path pointing to the font file to a variable for later reuse.</p><pre><code>document.documentElement.className = &#x27;fallback&#x27;;
var css_href = &#x27;../path/fonts.css&#x27;;</code></pre><p>Next we need to check for local storage support by trying to set and get an item into local storage. Some browsers can’t store anything in private mode but <code>window.localStorage</code> will still return a storage object. We need this extra request to make sure that our script will work properly:</p><pre><code>var localStorageSupported = function() {
  return &#x27;localStorage&#x27; in window;
}</code></pre><p>If the browser passes the <code>localStorageSupported</code> test and our font file is already stored, we can get the file and add it to the page header inside a <code>style</code> tag using the <code>injectRawStyle()</code> function. If the browser doesn’t pass the test, we call the <code>injectFontsStylesheet()</code> function on the <code>onLoad</code> event, so that we don’t block the ui thread:</p><pre><code>if (localStorageSupported() &amp;&amp; localStorage.webFonts) {
  injectRawStyle(localStorage.webFonts);
} else {
  window.onload = function() {
    injectFontsStylesheet();
  } 
}</code></pre><p>The <code>injectFontsStylesheet()</code> function makes an <code>xhr</code> request to get the font file content, injects it into the header with the help of the <code>injectRawStyle</code> function and saves it to local storage:</p><pre><code>function injectFontsStylesheet() {
  var xhr = new XMLHttpRequest();
  xhr.open(&#x27;GET&#x27;, css_href, true);
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4) {
      injectRawStyle(xhr.responseText);
      localStorage.webFonts = xhr.responseText;
    }
    xhr.send();
  }
}</code></pre><p>This is the function that creates the <code>style</code> tag in the <code>head</code> of the document and gets its content through the <code>text</code> parameter. It’s also at this stage that we replace the fallback class with the font class that has the web font styles:</p><pre><code>function injectRawStyle(text) {
  var style = document.createElement(&#x27;style&#x27;);
  style.innerHTML = text;
  document.getElementsByTagName(&#x27;head&#x27;)[0].appendChild(style);
  document.documentElement.className = &#x27;webFont&#x27;;
}</code></pre><p>With this solution, you’re now able to store your fonts asynchronously into local storage, while providing a good and reliable fallback font.</p></div><ul class="share"><li class="presentation">Share this:</li><li class="presentation"><a href="https://www.facebook.com/sharer/sharer.php?u=/post/font-loading-techniques" target="_blank" rel="nofollow" title="Font Loading Techniques"><i class="fa fa-facebook"></i> <span class="hidden-xs">Facebook</span></a></li><li class="presentation"><a href="https://twitter.com/home?status=Font Loading Techniques+/post/font-loading-techniques" target="_blank" rel="nofollow" title="Font Loading Techniques"><i class="fa fa-twitter"></i> <span class="hidden-xs">Twitter</span></a></li><li class="presentation"><a href="https://plus.google.com/share?url=/post/font-loading-techniques" target="_blank" rel="nofollow" title="Font Loading Techniques"><i class="fa fa-google-plus"></i> <span class="hidden-xs">Google+</span></a></li><li class="presentation"><a href="http://www.stumbleupon.com/submit?url=/post/font-loading-techniques&amp;amp;title=Font Loading Techniques" target="_blank" rel="nofollow" title="Font Loading Techniques"><i class="fa fa-stumbleupon"></i> <span class="hidden-xs">Stumble</span></a></li><li class="presentation"><a href="http://digg.com/submit?url=/post/font-loading-techniques&amp;amp;title=Font Loading Techniques" target="_blank" rel="nofollow" title="Font Loading Techniques"><i class="fa fa-digg"></i> <span class="hidden-xs">Digg</span></a></li></ul></div></article></div><div class="col-md-3"><div class="widget panel panel-default"><div class="panel-heading"><h4>Follow Us<span class="social pull-right"><a href="https://www.facebook.com/websnippet.io" title="facebook" rel="nofollow" target="_blank" class="nodecoration"><i class="fa fa-facebook" aria-hidden="true"></i><span class="sr-only">facebook</span></a><a href="https://twitter.com/WebSnippetio" title="twitter" rel="nofollow" target="_blank" class="nodecoration"><i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">twitter</span></a><a href="https://plus.google.com/109007174257357268166" title="google+" rel="nofollow" target="_blank" class="nodecoration"><i class="fa fa-google-plus" aria-hidden="true"></i><span class="sr-only">google+</span></a><a href="http://feeds2.feedburner.com/WebSnippet" title="rss" target="_blank" class="nodecoration"><i class="fa fa-rss" aria-hidden="true"></i><span class="sr-only">rss</span></a></span></h4></div><div class="panel-body"><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow"><input type="hidden" value="WebSnippet" name="uri"/><input type="hidden" name="loc" value="en_US"/><div class="form-group"><label class="sr-only" for="subemail">Enter your email address</label><div class="input-group"><input type="text" id="subemail" name="email" class="form-control" placeholder="Your email address..."/><span class="input-group-btn"><button class="btn btn-default" type="submit" aria-label="Subscribe"><i class="fa fa-fire" aria-hidden="true"></i></button></span></div></div></form></div></div><div class="widget panel panel-default"><div class="panel-heading"><h4>CATEGORIES</h4></div><div class="panel-body"><nav><h5><a href="/categories/algorithm" title="Algorithm">Algorithm<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/categories/design" title="Design">Design<!-- --> (<!-- -->10<!-- -->)</a></h5><h5><a href="/categories/development" title="Development">Development<!-- --> (<!-- -->38<!-- -->)</a></h5><h5><a href="/categories/interview" title="interview">interview<!-- --> (<!-- -->2<!-- -->)</a></h5><h5><a href="/categories/intreview" title="intreview">intreview<!-- --> (<!-- -->2<!-- -->)</a></h5><h5><a href="/categories/mobile-development" title="Mobile-Development">Mobile-Development<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/categories/resources" title="Resources">Resources<!-- --> (<!-- -->15<!-- -->)</a></h5><h5><a href="/categories/system design" title="System Design">System Design<!-- --> (<!-- -->2<!-- -->)</a></h5><h5><a href="/categories/system-design" title="System-Design">System-Design<!-- --> (<!-- -->2<!-- -->)</a></h5><h5><a href="/categories/tools" title="Tools">Tools<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/categories/web management" title="Web Management">Web Management<!-- --> (<!-- -->5<!-- -->)</a></h5><h5><a href="/categories/web-development" title="Web-Development">Web-Development<!-- --> (<!-- -->37<!-- -->)</a></h5></nav></div></div><div class="widget panel panel-default"><div class="panel-heading"><h4>TAGS</h4></div><div class="panel-body"><nav><h5><a href="/tags/.net" title=".NET">.NET<!-- --> (<!-- -->2<!-- -->)</a></h5><h5><a href="/tags/algorithm" title="Algorithm">Algorithm<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/tags/angularjs" title="AngularJS">AngularJS<!-- --> (<!-- -->4<!-- -->)</a></h5><h5><a href="/tags/css" title="CSS">CSS<!-- --> (<!-- -->7<!-- -->)</a></h5><h5><a href="/tags/html" title="HTML">HTML<!-- --> (<!-- -->4<!-- -->)</a></h5><h5><a href="/tags/interview" title="interview">interview<!-- --> (<!-- -->5<!-- -->)</a></h5><h5><a href="/tags/interviews" title="interviews">interviews<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/tags/intreview" title="intreview">intreview<!-- --> (<!-- -->2<!-- -->)</a></h5><h5><a href="/tags/javascript" title="JavaScript">JavaScript<!-- --> (<!-- -->27<!-- -->)</a></h5><h5><a href="/tags/mobile" title="Mobile">Mobile<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/tags/node.js" title="Node.JS">Node.JS<!-- --> (<!-- -->8<!-- -->)</a></h5><h5><a href="/tags/react" title="React">React<!-- --> (<!-- -->1<!-- -->)</a></h5><h5><a href="/tags/tools" title="Tools">Tools<!-- --> (<!-- -->1<!-- -->)</a></h5></nav></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"title":"Font Loading Techniques","description":"It seems as though most websites use non-default fonts these days and who can blame them?  System fonts are all pretty boring and custom fonts add a bit of flare and freshness to a site's design.  The problem with using custom fonts, however, is they can really slow down your site load.  Font files are large, can require separate font files for bold and italic, and can block rendering if the developer doesn't work around them.  Let me show you a strategy for faster font loading!","date":"2015-06-13T09:12:43.044Z","lastmod":"2015-06-13T09:12:43.044Z","slug":"font-loading-techniques","categories":["Web Management"],"tags":[],"thumbnail":"","image":"","source":"","content":"\n\nIt seems as though most websites use non-default fonts these days and who can blame them?  System fonts are all pretty boring and custom fonts add a bit of flare and freshness to a site's design.  Web fonts are great and make the web a more beautiful space; however, loading them can be slow, which results in an unwanted side effect. Let me show you a strategy for faster font loading!\n\n## Put Fonts on CDN\n\nOne simple solution for improving site speed is using a CDN, and that's no different for fonts.  It's important to ensure the CDN has proper CORS settings.\n\n    # Apache config\n    \u003cFilesMatch \".(eot|ttf|otf|woff)\"\u003e\n    \tHeader set Access-Control-Allow-Origin \"*\"\n    \u003c/FilesMatch\u003e\n\n    # nginx config\n    if ($filename ~* ^.*?\\.(eot)|(ttf)|(woff)$){\n    \tadd_header Access-Control-Allow-Origin *;\n    }\n\nYou'll see AJAX / cross-domain errors in the console if the CDN's CORS settings are not properly configured.\n\n## Use Non-Blocking CSS Loading\n\n It's actually genius, which outlines a strategy for preventing CSS loading from blocking render. \n\n    \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"fonts.css\" media=\"none\" onload=\"this.media='all';\"\u003e\n    \u003clink rel=\"stylesheet\" type=\"text/css\" href=\"style.css\" media=\"none\" onload=\"this.media='all';\"\u003e\n\nEssentially using media=none let's the browser download the stylesheet without blocking rendering, so when the stylesheet has loaded, setting the media(`onload=\"this.media='all';\"`) to its desired setting will then render the screen as it should.\n\n## Storing Fonts in localStorage\n\nFirst let’s add a class to the `\u003chtml\u003e` DOM node that will hold the fallback font styles. Using JavaScript, this will later be replaced with a class that has the styles of the loaded font. We will also save a path pointing to the font file to a variable for later reuse.\n\n    document.documentElement.className = 'fallback';\n    var css_href = '../path/fonts.css';\n\nNext we need to check for local storage support by trying to set and get an item into local storage. Some browsers can’t store anything in private mode but `window.localStorage` will still return a storage object. We need this extra request to make sure that our script will work properly:\n\n    var localStorageSupported = function() {\n      return 'localStorage' in window;\n    }\n\nIf the browser passes the `localStorageSupported` test and our font file is already stored, we can get the file and add it to the page header inside a `style` tag using the `injectRawStyle()` function. If the browser doesn’t pass the test, we call the `injectFontsStylesheet()` function on the `onLoad` event, so that we don’t block the ui thread:\n\n    if (localStorageSupported() \u0026\u0026 localStorage.webFonts) {\n      injectRawStyle(localStorage.webFonts);\n    } else {\n      window.onload = function() {\n        injectFontsStylesheet();\n      } \n    }\n\nThe `injectFontsStylesheet()` function makes an `xhr` request to get the font file content, injects it into the header with the help of the `injectRawStyle` function and saves it to local storage:\n\n    function injectFontsStylesheet() {\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', css_href, true);\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState === 4) {\n          injectRawStyle(xhr.responseText);\n          localStorage.webFonts = xhr.responseText;\n        }\n        xhr.send();\n      }\n    }\n\nThis is the function that creates the `style` tag in the `head` of the document and gets its content through the `text` parameter. It’s also at this stage that we replace the fallback class with the font class that has the web font styles:\n\n    function injectRawStyle(text) {\n      var style = document.createElement('style');\n      style.innerHTML = text;\n      document.getElementsByTagName('head')[0].appendChild(style);\n      document.documentElement.className = 'webFont';\n    }\n\nWith this solution, you’re now able to store your fonts asynchronously into local storage, while providing a good and reliable fallback font.","permalink":"/post/font-loading-techniques","site":{"categories":[{"name":"Algorithm","count":1},{"name":"Design","count":10},{"name":"Development","count":38},{"name":"interview","count":2},{"name":"intreview","count":2},{"name":"Mobile-Development","count":1},{"name":"Resources","count":15},{"name":"System Design","count":2},{"name":"System-Design","count":2},{"name":"Tools","count":1},{"name":"Web Management","count":5},{"name":"Web-Development","count":37}],"tags":[{"name":".NET","count":2},{"name":"Algorithm","count":1},{"name":"AngularJS","count":4},{"name":"CSS","count":7},{"name":"HTML","count":4},{"name":"interview","count":5},{"name":"interviews","count":1},{"name":"intreview","count":2},{"name":"JavaScript","count":27},{"name":"Mobile","count":1},{"name":"Node.JS","count":8},{"name":"React","count":1},{"name":"Tools","count":1}]}},"__N_SSG":true},"page":"/post/[slug]","query":{"slug":"font-loading-techniques"},"buildId":"FoH3w9_hi_Ui1DqHiOWf8","isFallback":false,"gsp":true,"scriptLoader":[]}</script><footer><div class="container"><div class="text-center social"><a href="mailto:hello@websnippet.io" title="email" rel="nofollow"><i class="fa fa-envelope" aria-hidden="true"></i><span class="sr-only">email</span></a><a href="https://www.facebook.com/websnippet.io" title="facebook" rel="nofollow" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i><span class="sr-only">facebook</span></a><a href="https://twitter.com/WebSnippetio" title="twitter" rel="nofollow" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i><span class="sr-only">twitter</span></a><a href="https://plus.google.com/109007174257357268166" title="google+" rel="nofollow" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i><span class="sr-only">google+</span></a><a href="http://feeds2.feedburner.com/WebSnippet" title="rss" target="_blank"><i class="fa fa-rss" aria-hidden="true"></i><span class="sr-only">rss</span></a></div></div></footer></body></html>