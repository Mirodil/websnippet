{"pageProps":{"title":"How do you design the Vending Machine","description":"How do you design the Vending Machine. We will write code to implement a Vending machine that has a bunch of products like chocolates, candy, cold-drink, and accept some coins like Nickle, Dime, Quarter, Cent, etc. Make sure you insert a coin, get a product back, and get your chance back.","date":"2021-10-01T00:00:00.854Z","lastmod":"2021-10-01T00:00:00.854Z","slug":"design-vending-machine","categories":["System Design"],"tags":["Interview"],"thumbnail":"/assets/design-vending-machine.jpg","image":"/assets/design-vending-machine.jpg","content":"\n\n# How do you design the Vending Machine\n\nYou need to write code to implement a Vending machine that has a bunch of products like chocolates, candy, cold-drink, and accept some coins like Nickle, Dime, Quarter, Cent, etc. Make sure you insert a coin, get a product back, and get your chance back.\n\nWe are going to make some assumtions to simplicity sake:\n- We assume we have endless products, so we don't have throw a ProductSoldOutExcepiton\n- We assume we have endless coins, so we don't have throw a NotSufficientChangeException\n\n\n### State transition diagrams\n\nState transition diagram is an efficient form for depicting a finite state machine, and it is called a state transition diagram. We will start with a state transition diagram, and we follow the arrows, and we say the arrows in the `Given-When-Then` form, then you get something like this.\nLet's draw state transition diagramm for the Vending Machine.\n\n![vending machine state transition diagram](/assets/design-vending-machine-state-transition-diagram.svg) \n\n### State transition tables\nState transition table is in `given->then->then` form:\n\n| Given State   | Event       | Next State      | Action    |\n| -----------   | ----------- | --------------  | ----------|\n| ProductsState | select      | ChargeState     | display charge |\n| ChargeState   | coin        | CollectState    | return product & refund |\n| CollectState  | reset       | ProductsState   | display products |\n| ProductsState | coin        | ProductsState   | return changes |\n| CollectState  | coin        | CollectState    | display charge // when not enought coin |\n| CollectState  | select      | CollectState    | display charge |\n| ChargeState   | select      | ChargeState     | display charge // change product |\n\n\n### Implementation\n\nThe simplest way is to implement with switch-case statements. We need to create our events and state as enum and implement VendingMachine finite state machine.\n\n\n```typescript\nenum EVENTS {\n    SELECT,\n    COIN,\n    RESET\n}\n\nenum STATE {\n    PRODUCTS,\n    CHARGE,\n    COLLECT\n}\n\ntype Product = {\n    name: string;\n    price: number;\n};\n\ninterface IVendingMachine {\n    refund(charges: number): void;\n    unloadProduct(selectedProduct: Product): void;\n    displayCharges(price: number): void;\n    displayProducts(list: Product[]): void;\n}\n\n/**\n * VendingMachine - finite state machine\n */\nclass VendingMachineFSM {\n    private products: Array<Product> = [];\n    private selectedProduct?: Product;\n    private balance: number = 0;\n    private state: STATE;\n    private vm: IVendingMachine;\n\n    constructor(vm: IVendingMachine) {\n        this.vm = vm;\n        this.state = STATE.PRODUCTS;\n    }\n\n    handleEvents(event: EVENTS, product: Product, coin: number) {\n        switch (this.state) {\n            case STATE.PRODUCTS:\n                switch (event) {\n                    case EVENTS.SELECT:\n                        this.state = STATE.CHARGE;\n                        this.selectedProduct = product;\n                        this.balance = this.selectedProduct.price;\n                        this.vm.displayCharges(this.balance);\n                        break;\n                    case EVENTS.COIN:\n                    case EVENTS.RESET:\n                        this.selectedProduct = undefined;\n                        this.balance = 0;\n                        this.vm.displayProducts(this.products);\n                        break;\n                }\n                break;\n            case STATE.CHARGE:\n                switch (event) {\n                    case EVENTS.SELECT:\n                        this.selectedProduct = product;\n                        this.balance = this.selectedProduct.price;\n                        this.vm.displayCharges(this.balance);\n                    case EVENTS.COIN:\n                        this.state = STATE.COLLECT;\n                        this.balance -= coin;\n                        if (this.balance <= 0) {\n                            this.vm.unloadProduct(this.selectedProduct!);\n                            this.vm.refund(this.balance);\n                            this.state = STATE.PRODUCTS;\n                        } else {\n                            this.vm.displayCharges(this.balance);\n                        }\n                    case EVENTS.RESET:\n                        this.state = STATE.PRODUCTS;\n                        this.selectedProduct = undefined;\n                        this.balance = 0;\n                }\n                break;\n            case STATE.COLLECT:\n                switch (event) {\n                    case EVENTS.COIN:\n                        this.balance -= coin;\n                        if (this.balance <= 0) {\n                            this.vm.unloadProduct(this.selectedProduct!);\n                            this.vm.refund(this.balance);\n                            this.state = STATE.PRODUCTS;\n                        } else {\n                            this.vm.displayCharges(this.balance);\n                        }\n                    case EVENTS.SELECT:\n                    case EVENTS.RESET:\n                        this.state = STATE.PRODUCTS;\n                        this.selectedProduct = undefined;\n                        this.balance = 0;\n                        this.vm.displayProducts(this.products);\n                        break;\n                }\n        }\n    }\n}\n```\nAs you can notice we are sperating a state(`VendingMachineFSM`) from a vending machine(`IVendingMachine`) by using interface.\nAs Vending Machine is a State Machine. The events and actions are what is being controlled, and the finite state machine is how that control is managed, and those two can be encapsulated and kept completely separate from one another. The separation of what from how is one of the most essential aspects of good software design.\nToo often we find software systems in which what from how are so intertangled that it's very difficult to separate operation from policy. And when you can't separate what from how, well then you wind up with systems that are pretty fragile.\n\nThe other version is implement state transition table using lists or dictionary data structure and it called table driven approach.\n\n\n### State pattern\n\n> The state pattern is a behavioral software design pattern that allows an object to alter its behavior when its internal state changes\n> wiki\n\n```typescript\n\ninterface IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void;\n    coin(vm: VendingMachineFSM_DP, coin: number): void;\n    select(vm: VendingMachineFSM_DP, product: Product): void;\n}\n\nabstract class VendingMachineFSM_DP {\n    state: IVendingMachineState;\n    balance: number = 0;\n    selectedProduct?: Product;\n    availableProducts: Product[] = [];\n\n    constructor(state: IVendingMachineState) {\n        this.state = state;\n    }\n\n    select(product: Product) {\n        this.state.select(this, product);\n    }\n\n    coin(coin: number) {\n        this.state.coin(this, coin);\n    }\n\n    reset() {\n        this.state.reset(this);\n    }\n\n    // methods will be implemented by concrete Vending Machine\n    abstract returnChanges(charges: number): void;\n    abstract unloadProduct(selectedProduct: Product): void;\n    abstract displayCharges(price: number): void;\n    abstract displayProducts(list: Product[]): void;\n}\n\nclass ProductState implements IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void {\n        vm.displayProducts(vm.availableProducts);\n    }\n\n    coin(vm: VendingMachineFSM_DP, coin: number): void {\n        vm.returnChanges(coin);\n        vm.displayProducts(vm.availableProducts);\n    }\n\n    select(vm: VendingMachineFSM_DP, product: Product): void {\n        vm.state = new ChargeState();\n        vm.balance = product.price\n        vm.displayCharges(vm.balance);\n    }\n}\n\nclass ChargeState implements IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void {\n        vm.state = new ProductState();\n        vm.displayProducts(vm.availableProducts);\n    }\n\n    coin(vm: VendingMachineFSM_DP, coin: number): void {\n        vm.state = new ChargeState();\n        vm.balance -= coin;\n        if (vm.balance <= 0) {\n            vm.state = new ProductState();\n            vm.unloadProduct(vm.selectedProduct!);\n            vm.returnChanges(vm.balance);\n        } else {\n            vm.displayCharges(vm.balance);\n        }\n    }\n\n    select(vm: VendingMachineFSM_DP, product: Product): void {\n        vm.balance = product.price;\n        vm.displayCharges(product.price);\n    }\n}\n\nclass CollectState implements IVendingMachineState {\n    reset(vm: VendingMachineFSM_DP): void {\n        throw new Error(\"Method not implemented.\");\n    }\n\n    coin(vm: VendingMachineFSM_DP, coin: number): void {\n        vm.balance -= coin;\n        if (vm.balance <= 0) {\n            vm.state = new ProductState();\n            vm.unloadProduct(vm.selectedProduct!);\n            vm.returnChanges(vm.balance);\n        } else {\n            vm.displayCharges(vm.balance);\n        }\n    }\n\n    select(vm: VendingMachineFSM_DP, product: Product): void {\n        throw new Error(\"Method not implemented.\");\n    }\n\n}\n\n```\n\n","permalink":"/post/design-vending-machine","site":{"categories":[{"name":"Algorithm","count":1},{"name":"Design","count":10},{"name":"Development","count":37},{"name":"Interview","count":1},{"name":"Mobile-Development","count":1},{"name":"Resources","count":14},{"name":"System Design","count":1},{"name":"Tools","count":1},{"name":"Web Management","count":5},{"name":"Web-Development","count":36}],"tags":[{"name":".NET","count":2},{"name":"Algorithm","count":1},{"name":"AngularJS","count":4},{"name":"CSS","count":6},{"name":"HTML","count":3},{"name":"Interview","count":2},{"name":"JavaScript","count":26},{"name":"Mobile","count":1},{"name":"Node.JS","count":8},{"name":"React","count":1},{"name":"Tools","count":1}]}},"__N_SSG":true}