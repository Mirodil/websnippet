{"pageProps":{"title":"Font Loading Techniques","description":"It seems as though most websites use non-default fonts these days and who can blame them?  System fonts are all pretty boring and custom fonts add a bit of flare and freshness to a site's design.  The problem with using custom fonts, however, is they can really slow down your site load.  Font files are large, can require separate font files for bold and italic, and can block rendering if the developer doesn't work around them.  Let me show you a strategy for faster font loading!","date":"2015-06-13T09:12:43.044Z","lastmod":"2015-06-13T09:12:43.044Z","slug":"font-loading-techniques","categories":["Web Management"],"tags":[],"thumbnail":"","image":"","source":"","content":"\n\nIt seems as though most websites use non-default fonts these days and who can blame them?  System fonts are all pretty boring and custom fonts add a bit of flare and freshness to a site's design.  Web fonts are great and make the web a more beautiful space; however, loading them can be slow, which results in an unwanted side effect. Let me show you a strategy for faster font loading!\n\n## Put Fonts on CDN\n\nOne simple solution for improving site speed is using a CDN, and that's no different for fonts.  It's important to ensure the CDN has proper CORS settings.\n\n    # Apache config\n    <FilesMatch \".(eot|ttf|otf|woff)\">\n    \tHeader set Access-Control-Allow-Origin \"*\"\n    </FilesMatch>\n\n    # nginx config\n    if ($filename ~* ^.*?\\.(eot)|(ttf)|(woff)$){\n    \tadd_header Access-Control-Allow-Origin *;\n    }\n\nYou'll see AJAX / cross-domain errors in the console if the CDN's CORS settings are not properly configured.\n\n## Use Non-Blocking CSS Loading\n\n It's actually genius, which outlines a strategy for preventing CSS loading from blocking render. \n\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"fonts.css\" media=\"none\" onload=\"this.media='all';\">\n    <link rel=\"stylesheet\" type=\"text/css\" href=\"style.css\" media=\"none\" onload=\"this.media='all';\">\n\nEssentially using media=none let's the browser download the stylesheet without blocking rendering, so when the stylesheet has loaded, setting the media(`onload=\"this.media='all';\"`) to its desired setting will then render the screen as it should.\n\n## Storing Fonts in localStorage\n\nFirst let’s add a class to the `<html>` DOM node that will hold the fallback font styles. Using JavaScript, this will later be replaced with a class that has the styles of the loaded font. We will also save a path pointing to the font file to a variable for later reuse.\n\n    document.documentElement.className = 'fallback';\n    var css_href = '../path/fonts.css';\n\nNext we need to check for local storage support by trying to set and get an item into local storage. Some browsers can’t store anything in private mode but `window.localStorage` will still return a storage object. We need this extra request to make sure that our script will work properly:\n\n    var localStorageSupported = function() {\n      return 'localStorage' in window;\n    }\n\nIf the browser passes the `localStorageSupported` test and our font file is already stored, we can get the file and add it to the page header inside a `style` tag using the `injectRawStyle()` function. If the browser doesn’t pass the test, we call the `injectFontsStylesheet()` function on the `onLoad` event, so that we don’t block the ui thread:\n\n    if (localStorageSupported() && localStorage.webFonts) {\n      injectRawStyle(localStorage.webFonts);\n    } else {\n      window.onload = function() {\n        injectFontsStylesheet();\n      } \n    }\n\nThe `injectFontsStylesheet()` function makes an `xhr` request to get the font file content, injects it into the header with the help of the `injectRawStyle` function and saves it to local storage:\n\n    function injectFontsStylesheet() {\n      var xhr = new XMLHttpRequest();\n      xhr.open('GET', css_href, true);\n      xhr.onreadystatechange = function() {\n        if (xhr.readyState === 4) {\n          injectRawStyle(xhr.responseText);\n          localStorage.webFonts = xhr.responseText;\n        }\n        xhr.send();\n      }\n    }\n\nThis is the function that creates the `style` tag in the `head` of the document and gets its content through the `text` parameter. It’s also at this stage that we replace the fallback class with the font class that has the web font styles:\n\n    function injectRawStyle(text) {\n      var style = document.createElement('style');\n      style.innerHTML = text;\n      document.getElementsByTagName('head')[0].appendChild(style);\n      document.documentElement.className = 'webFont';\n    }\n\nWith this solution, you’re now able to store your fonts asynchronously into local storage, while providing a good and reliable fallback font.","permalink":"/post/font-loading-techniques","site":{"categories":[{"name":"Algorithm","count":1},{"name":"Design","count":10},{"name":"Development","count":38},{"name":"Interview","count":4},{"name":"Mobile-Development","count":1},{"name":"Resources","count":15},{"name":"System Design","count":2},{"name":"System-Design","count":2},{"name":"Tools","count":1},{"name":"Web Management","count":5},{"name":"Web-Development","count":37}],"tags":[{"name":".NET","count":2},{"name":"Algorithm","count":1},{"name":"AngularJS","count":4},{"name":"CSS","count":7},{"name":"HTML","count":4},{"name":"Interview","count":8},{"name":"JavaScript","count":27},{"name":"Mobile","count":1},{"name":"Node.JS","count":8},{"name":"React","count":1},{"name":"Tools","count":1}]}},"__N_SSG":true}